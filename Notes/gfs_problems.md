![forgs](./63671600_p0.png)

Future

死锁的解决方法
# mapreduce
* sort的mapreduce结构？
* 文件/任务分配
* 4.1 & 4.2如何实现？


# Problems
* 如何定义 文件打开
## 2.3
* POSIX/linux vnode

## 2.6
* 元数据,包括:文件和 Chunk 的命名空间
* 元数据用什么数据结构？
* 或者有新的 Chunk 服务器加入时,向各个 Chunk服务器轮询它们所存储的 Chunk 的信息
### 2.6.1
* 每个文件的在命名空间中的数据大小 **通常** 在64字节以下,因为保存的文件名是用前缀压缩算法压缩过的。

### 2.6.3
* 逻辑时间
* 重演操作日志（只恢复master的索引？）
* 以及重演 Checkpoint 之后的有限个日志文件就能够恢复系统。
Checkpoint 文件以压缩 B-树形势的数据结构存储,可以直接映射到内存,在用于命名空间查询时无需额外的解析。
* Checkpoint 失败不会对正确性产生任何影响,因为恢复功能的代码可以检测并跳
过没有完成的 Checkpoint 文件。
## 2.7
### 2.7.1
* 串行成功/并行成功
* region
* (相比而言,通常说的追加操作写的偏移位置是文件的尾部。)
* 在文件中间插入填充数据或者重复记录 和 写入的区别
* 多个用户同时尝试修改一个位置会怎么样
* 时间窗
* 缓存的超时时间和文件下一次被打开的时间之间存在一个时间窗,文件再次被打开后会清除缓存中与该文件有关的所有 Chunk 位置信息。而且,由于我们的文件大多数都是只进行追加操作的,所以,一个失效的副本通常返回一个提前结束的 Chunk 而不是过期的数据。
### 2.7.2
* ????
## 3.1
* Master 节点会试图提前取消租约
  (例如,Master 节点想取消在一个已经被改名的文件上的修改操作 )
* **客户机** 可以以任意的顺序推送数据。
* Chunk 服务器接收到数据并保存在它的 **内部 LRU 缓存** 中,**一直到数据被使用或者过期交换出去。**
* 主 Chunk 为接收到的所有操作分配连续的序列号,序列号保证了操作顺序执行。
* 主 Chunk 回复客户机时出现错误如何处理
* 数据量很大，共享的文件 region 的尾部可能包含来自不同客户机的数据。这使文件 region 处于2.7节描述的一致的、但是未定义的状态。

## 3.3
* ???

## 3.4
* 租约取消或者过期之后……如何建立快照？
* 快照操作之后建立Chunk C‘？

## 4.1
* 读锁和读写锁如何区分？
* 因为名称空间可能有很多节点,读写锁采用 **惰性分配** 策略？
* 锁的获取也要依据一个全局一致的顺序来避免死锁:
  首先按名称空间的层次排序,在同一个层次内按字典顺序排序。
## 4.4
### 4.4.1
* 对 Chunk 名字空间做类似的常规扫描
* **孤儿 Chunk** 为何会出现
* Master 节点并不马上回收资源,而是把文件名改为一个包含删除
时间戳的、隐藏的名字：
	* Chunkserver 只保存chunk具体的内容，不知道这个chunk属于哪里？
	* 如何重命名
## 4.5
* 如果 Master 节点看到一个比它记录的版本号更高的版本号
## 5.1
### 5.1.2
* 奇偶校验、或者 Erasure codes
* 用来解决日益增长的 **只读存储** 需求
* 很少有随机的写入操作,**因此**,我们认为在我们这个 **高度解耦合的系统架构** 下实现这些复杂的冗余方案很有挑战性,但并非不可实现。
### 5.1.3
* 对 Master 服务器状态的修改操作能够提交成功的前提是,操作日志写入到 Master 服务器的备节点和本机的磁盘。
* 在主 Master 服务器因创建和删除副本导致副本位置信息更新时,“影子”Master 服务器才和主 Master 服务器通信来更新自身状态。
## 5.2
* GFS 允许有歧义的副本存在
* Checksum 与其它的用户数据是分开的,并且保存在 **内存和硬盘** 上,同时也 **记录操作日志** 。
* GFS 客户端代码通过每次把读取操作都对齐在 Checksum block 的边界上
* ,Chunksum 的查找和比较不需要 I/O 操作,Checksum 的计算可以和 **I/O 操作** 同时进行。
* 如果我们不校验第一个和最后一个被写的块,那么新的 Checksum 可能会隐藏没有被覆盖区域内的数据错误。 ->(意思是第一个块和最后一个是从一半改写的？)
***

![girl](./60608337_p0.jpg 'girl')
***
![girl](https://i.pximg.net/img-original/img/2016/12/28/14/01/16/60608337_p0.jpg)
